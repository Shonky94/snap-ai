// Emoji Service - Keyword matching and auto-placement logic

export interface EmojiCategory {
  id: string;
  name: string;
  icon: string;
  emojis: string[];
}

// Comprehensive emoji library organized by category
export const EMOJI_CATEGORIES: EmojiCategory[] = [
  {
    id: 'smileys',
    name: 'Smileys & People',
    icon: '😊',
    emojis: [
      '😀', '😃', '😄', '😁', '😆', '😅', '🤣', '😂',
      '🙂', '🙃', '😉', '😊', '😇', '🥰', '😍', '🤩',
      '😘', '😗', '😚', '😙', '😋', '😛', '😜', '🤪',
      '😝', '🤑', '🤗', '🤭', '🤫', '🤔', '🤐', '🤨',
      '😐', '😑', '😶', '😏', '😒', '🙄', '😬', '🤥',
      '😌', '😔', '😪', '🤤', '😴', '😷', '🤒', '🤕',
      '🤢', '🤮', '🤧', '🥵', '🥶', '😵', '🤯', '🤠',
      '🥳', '😎', '🤓', '🧐', '😕', '😟', '🙁', '☹️',
      '😮', '😯', '😲', '😳', '🥺', '😦', '😧', '😨',
      '😰', '😥', '😢', '😭', '😱', '😖', '😣', '😞',
      '👋', '🤚', '🖐️', '✋', '🖖', '👌', '🤏', '✌️',
      '🤞', '🤟', '🤘', '🤙', '👈', '👉', '👆', '🖕',
      '👇', '☝️', '👍', '👎', '✊', '👊', '🤛', '🤜',
      '👏', '🙌', '👐', '🤲', '🤝', '🙏', '💪', '🦾',
    ]
  },
  {
    id: 'animals',
    name: 'Animals & Nature',
    icon: '🐶',
    emojis: [
      '🐶', '🐱', '🐭', '🐹', '🐰', '🦊', '🐻', '🐼',
      '🐨', '🐯', '🦁', '🐮', '🐷', '🐽', '🐸', '🐵',
      '🙈', '🙉', '🙊', '🐒', '🐔', '🐧', '🐦', '🐤',
      '🐣', '🐥', '🦆', '🦅', '🦉', '🦇', '🐺', '🐗',
      '🐴', '🦄', '🐝', '🐛', '🦋', '🐌', '🐞', '🐜',
      '🦟', '🦗', '🕷️', '🕸️', '🦂', '🐢', '🐍', '🦎',
      '🦖', '🦕', '🐙', '🦑', '🦐', '🦞', '🦀', '🐡',
      '🐠', '🐟', '🐬', '🐳', '🐋', '🦈', '🐊', '🐅',
      '🐆', '🦓', '🦍', '🦧', '🐘', '🦛', '🦏', '🐪',
      '🐫', '🦒', '🦘', '🐃', '🐂', '🐄', '🐎', '🐖',
      '🐏', '🐑', '🦙', '🐐', '🦌', '🐕', '🐩', '🦮',
      '🐕‍🦺', '🐈', '🐓', '🦃', '🦚', '🦜', '🦢', '🦩',
      '🌸', '💮', '🏵️', '🌹', '🥀', '🌺', '🌻', '🌼',
      '🌷', '🌱', '🌲', '🌳', '🌴', '🌵', '🌾', '🌿',
      '☘️', '🍀', '🍁', '🍂', '🍃', '🌍', '🌎', '🌏',
    ]
  },
  {
    id: 'food',
    name: 'Food & Drink',
    icon: '🍕',
    emojis: [
      '🍎', '🍏', '🍊', '🍋', '🍌', '🍉', '🍇', '🍓',
      '🍈', '🍒', '🍑', '🥭', '🍍', '🥥', '🥝', '🍅',
      '🍆', '🥑', '🥦', '🥬', '🥒', '🌶️', '🌽', '🥕',
      '🥔', '🍠', '🥐', '🥯', '🍞', '🥖', '🥨', '🧀',
      '🥚', '🍳', '🧈', '🥞', '🧇', '🥓', '🥩', '🍗',
      '🍖', '🦴', '🌭', '🍔', '🍟', '🍕', '🥪', '🥙',
      '🧆', '🌮', '🌯', '🥗', '🥘', '🥫', '🍝', '🍜',
      '🍲', '🍛', '🍣', '🍱', '🥟', '🦐', '🍤', '🍙',
      '🍚', '🍘', '🍥', '🥠', '🥮', '🍢', '🍡', '🍧',
      '🍨', '🍦', '🥧', '🧁', '🍰', '🎂', '🍮', '🍭',
      '🍬', '🍫', '🍿', '🍩', '🍪', '🌰', '🥜', '🍯',
      '🥛', '🍼', '☕', '🍵', '🧃', '🥤', '🍶', '🍺',
      '🍻', '🥂', '🍷', '🥃', '🍸', '🍹', '🧉', '🍾',
    ]
  },
  {
    id: 'activities',
    name: 'Activities & Sports',
    icon: '⚽',
    emojis: [
      '⚽', '🏀', '🏈', '⚾', '🥎', '🎾', '🏐', '🏉',
      '🥏', '🎱', '🪀', '🏓', '🏸', '🏒', '🏑', '🥍',
      '🏏', '🥅', '⛳', '🪁', '🏹', '🎣', '🤿', '🥊',
      '🥋', '🎽', '🛹', '🛼', '🛷', '⛸️', '🥌', '🎿',
      '⛷️', '🏂', '🪂', '🏋️', '🤼', '🤸', '🤺', '⛹️',
      '🤾', '🏌️', '🏇', '🧘', '🏊', '🤽', '🚣', '🧗',
      '🚴', '🚵', '🎯', '🎮', '🕹️', '🎰', '🎲', '🧩',
      '♟️', '🎭', '🎨', '🧵', '🧶', '🎬', '🎤', '🎧',
      '🎼', '🎹', '🥁', '🎷', '🎺', '🎸', '🪕', '🎻',
      '🎪', '🎟️', '🎫', '🎗️', '🏆', '🏅', '🥇', '🥈',
      '🥉', '🎖️',
    ]
  },
  {
    id: 'travel',
    name: 'Travel & Places',
    icon: '✈️',
    emojis: [
      '🚗', '🚕', '🚙', '🚌', '🚎', '🏎️', '🚓', '🚑',
      '🚒', '🚐', '🚚', '🚛', '🚜', '🦯', '🦽', '🦼',
      '🛴', '🚲', '🛵', '🏍️', '🛺', '🚨', '🚔', '🚍',
      '🚘', '🚖', '🚡', '🚠', '🚟', '🚃', '🚋', '🚞',
      '🚝', '🚄', '🚅', '🚈', '🚂', '🚆', '🚇', '🚊',
      '🚉', '✈️', '🛫', '🛬', '🛩️', '💺', '🛰️', '🚀',
      '🛸', '🚁', '🛶', '⛵', '🚤', '🛥️', '🛳️', '⛴️',
      '🚢', '⚓', '⛽', '🚧', '🚦', '🚥', '🏁', '🚏',
      '🗺️', '🗿', '🗽', '🗼', '🏰', '🏯', '🏟️', '🎡',
      '🎢', '🎠', '⛲', '⛱️', '🏖️', '🏝️', '🏜️', '🌋',
      '⛰️', '🏔️', '🗻', '🏕️', '⛺', '🏠', '🏡', '🏘️',
      '🏚️', '🏗️', '🏭', '🏢', '🏬', '🏣', '🏤', '🏥',
      '🏦', '🏨', '🏪', '🏫', '🏩', '💒', '🏛️', '⛪',
      '🕌', '🕍', '🛕', '🕋', '⛩️', '🗾',
    ]
  },
  {
    id: 'objects',
    name: 'Objects & Symbols',
    icon: '💡',
    emojis: [
      '⌚', '📱', '📲', '💻', '⌨️', '🖥️', '🖨️', '🖱️',
      '🖲️', '🕹️', '🗜️', '💽', '💾', '💿', '📀', '📼',
      '📷', '📸', '📹', '🎥', '📽️', '🎞️', '📞', '☎️',
      '📟', '📠', '📺', '📻', '🎙️', '🎚️', '🎛️', '🧭',
      '⏱️', '⏲️', '⏰', '🕰️', '⌛', '⏳', '📡', '🔋',
      '🔌', '💡', '🔦', '🕯️', '🧯', '🛢️', '💸', '💵',
      '💴', '💶', '💷', '💰', '💳', '💎', '⚖️', '🧰',
      '🔧', '🔨', '⚒️', '🛠️', '⛏️', '🔩', '⚙️', '🧱',
      '⛓️', '🧲', '🔫', '💣', '🧨', '🔪', '🗡️', '⚔️',
      '🛡️', '🚬', '⚰️', '⚱️', '🏺', '🔮', '📿', '🧿',
      '💈', '⚗️', '🔭', '🔬', '🕳️', '💊', '💉', '🩸',
      '🩹', '🩺', '🌡️', '🧬', '🦠', '🧫', '🧪', '🌂',
      '☂️', '🧵', '🧶', '🪡', '🪢', '🧥', '🥼', '🦺',
      '👔', '👕', '👖', '🧣', '🧤', '🧦', '👗', '👘',
      '🥻', '🩱', '🩲', '🩳', '👙', '👚', '👛', '👜',
      '👝', '🎒', '👞', '👟', '🥾', '🥿', '👠', '👡',
      '🩰', '👢', '👑', '👒', '🎩', '🎓', '🧢', '⛑️',
      '💄', '💍', '💼', '🎀', '🎁', '🎈', '🎉', '🎊',
      '🎋', '🎌', '🎏', '🎐', '🧧', '✉️', '📩', '📨',
      '📧', '💌', '📮', '📪', '📫', '📬', '📭', '📦',
      '📯', '📥', '📤', '📜', '📃', '📄', '📑', '🧾',
      '📊', '📈', '📉', '📇', '🗃️', '🗳️', '🗄️', '📋',
      '📁', '📂', '🗂️', '🗞️', '📰', '📓', '📔', '📒',
      '📕', '📗', '📘', '📙', '📚', '📖', '🔖', '🧷',
      '🔗', '📎', '🖇️', '📐', '📏', '🧮', '📌', '📍',
      '✂️', '🖊️', '🖋️', '✒️', '🖌️', '🖍️', '📝', '✏️',
      '🔍', '🔎', '🔏', '🔐', '🔒', '🔓', '❤️', '🧡',
      '💛', '💚', '💙', '💜', '🖤', '🤍', '🤎', '💔',
      '❣️', '💕', '💞', '💓', '💗', '💖', '💘', '💝',
      '⭐', '🌟', '✨', '⚡', '💥', '🔥', '☀️', '🌈',
      '☁️', '⛅', '⛈️', '🌤️', '🌥️', '🌦️', '🌧️', '🌨️',
      '🌩️', '🌪️', '🌫️', '🌬️', '💨', '💧', '💦', '☔',
      '☃️', '⛄', '❄️', '🌀', '🌊', '🌙', '⭐',
    ]
  },
  {
    id: 'celebrations',
    name: 'Celebrations',
    icon: '🎉',
    emojis: [
      '🎂', '🎁', '🎈', '🎉', '🎊', '🎀', '🎗️', '🎟️',
      '🎫', '🏆', '🏅', '🥇', '🥈', '🥉', '🎖️', '🎯',
      '🎰', '🎲', '🧧', '💝', '💐', '🌹', '💒', '💍',
      '👑', '🥳', '🎭', '🎪', '🎨', '🎬', '🎤', '🎧',
      '🎼', '🎹', '🥁', '🎷', '🎺', '🎸', '🎻', '🎃',
      '🎄', '🎆', '🎇', '🧨', '✨', '🎋', '🎍', '🎎',
      '🎏', '🎐', '🧧', '🪔', '🕎', '🔯', '🪅', '🪆',
    ]
  },
];

// Get all emojis flattened
export const getAllEmojis = (): string[] => {
  return EMOJI_CATEGORIES.flatMap(cat => cat.emojis);
};

// Keyword to emoji mapping for auto-placement
const EMOJI_KEYWORDS: Record<string, string[]> = {
  // Emotions & Expressions
  'happy': ['😊', '😄', '😁', '🥰', '😍'],
  'love': ['❤️', '😍', '🥰', '💕', '💖'],
  'excited': ['🤩', '😆', '🎉', '✨', '⭐'],
  'fun': ['🎉', '😄', '🤪', '🎊', '🥳'],
  'celebrate': ['🎉', '🎊', '🥳', '🎈', '🎆'],
  'party': ['🎉', '🥳', '🎊', '🍾', '🎈'],
  'cool': ['😎', '🤩', '✨', '🔥', '⭐'],
  'amazing': ['🤩', '😍', '✨', '⭐', '💫'],
  'beautiful': ['😍', '🥰', '✨', '💖', '🌸'],
  'cute': ['🥰', '😍', '💕', '🌸', '💖'],
  'smile': ['😊', '😄', '😁', '🙂', '😃'],
  'laugh': ['😂', '🤣', '😆', '😄', '😁'],
  
  // Nature & Outdoors
  'beach': ['🏖️', '🌊', '☀️', '🌴', '🏝️'],
  'ocean': ['🌊', '🐚', '🐠', '🏖️', '⛵'],
  'sea': ['🌊', '🐚', '⛵', '🏖️', '🐠'],
  'sunset': ['🌅', '🌇', '☀️', '🌄', '🧡'],
  'sunrise': ['🌅', '🌄', '☀️', '🌞', '🌻'],
  'sun': ['☀️', '🌞', '🌅', '🌻', '🌼'],
  'moon': ['🌙', '🌛', '🌜', '🌚', '✨'],
  'star': ['⭐', '🌟', '✨', '💫', '🌠'],
  'sky': ['☁️', '🌤️', '🌈', '⭐', '🌙'],
  'rainbow': ['🌈', '✨', '🌟', '💫', '🎨'],
  'mountain': ['⛰️', '🏔️', '🗻', '🏕️', '🌲'],
  'forest': ['🌲', '🌳', '🌿', '🍃', '🌾'],
  'flower': ['🌸', '🌺', '🌻', '🌷', '🌹'],
  'nature': ['🌿', '🍃', '🌱', '🌲', '🌳'],
  
  // Food & Drink
  'food': ['🍕', '🍔', '🍟', '🍜', '🍱'],
  'pizza': ['🍕', '🍴', '😋', '🤤', '👌'],
  'burger': ['🍔', '🍟', '🥤', '😋', '🤤'],
  'coffee': ['☕', '🍵', '☕', '🥐', '📚'],
  'cake': ['🎂', '🍰', '🧁', '🎉', '🎈'],
  'birthday': ['🎂', '🎉', '🎈', '🎁', '🥳'],
  'drink': ['🥤', '🍹', '🍸', '🍷', '🍺'],
  'wine': ['🍷', '🍾', '🥂', '🍇', '🧀'],
  'breakfast': ['🥐', '☕', '🥞', '🍳', '🥓'],
  'lunch': ['🍔', '🍕', '🥗', '🍜', '🍱'],
  'dinner': ['🍝', '🍖', '🥘', '🍷', '🍴'],
  
  // Activities & Sports
  'travel': ['✈️', '🗺️', '🧳', '🌍', '📸'],
  'trip': ['✈️', '🗺️', '🧳', '🌍', '🏖️'],
  'adventure': ['🗺️', '⛰️', '🧭', '🏕️', '✈️'],
  'vacation': ['🏖️', '✈️', '🌴', '🏝️', '😎'],
  'holiday': ['🏖️', '✈️', '🎉', '🌴', '😎'],
  'gym': ['💪', '🏋️', '🤸', '🏃', '⚡'],
  'workout': ['💪', '🏋️', '🏃', '🤸', '🔥'],
  'fitness': ['💪', '🏋️', '🏃', '🥗', '⚡'],
  'run': ['🏃', '👟', '💪', '⚡', '🔥'],
  'sport': ['⚽', '🏀', '🎾', '🏆', '🥇'],
  'win': ['🏆', '🥇', '🎉', '👏', '🔥'],
  'music': ['🎵', '🎶', '🎸', '🎤', '🎧'],
  'concert': ['🎵', '🎸', '🎤', '🎉', '🔥'],
  'dance': ['💃', '🕺', '🎶', '🎉', '✨'],
  'art': ['🎨', '🖼️', '✨', '🖌️', '🎭'],
  'photography': ['📸', '📷', '✨', '🌟', '🎨'],
  'photo': ['📸', '📷', '✨', '🌟', '🎨'],
  
  // Animals
  'dog': ['🐶', '🐕', '🦴', '🐾', '❤️'],
  'cat': ['🐱', '🐈', '😻', '🐾', '❤️'],
  'pet': ['🐶', '🐱', '🐾', '❤️', '🥰'],
  
  // Objects & Technology
  'phone': ['📱', '💬', '📸', '📲', '🔋'],
  'car': ['🚗', '🏎️', '🛣️', '⚡', '🔥'],
  'book': ['📚', '📖', '☕', '🤓', '✨'],
  'read': ['📚', '📖', '☕', '🤓', '💡'],
  'study': ['📚', '📖', '✏️', '💻', '🤓'],
  'work': ['💼', '💻', '📊', '☕', '💪'],
  
  // Times & Events
  'morning': ['🌅', '☕', '🥐', '🌞', '✨'],
  'night': ['🌙', '✨', '🌃', '🌌', '🌠'],
  'evening': ['🌆', '🌇', '🌙', '✨', '🍷'],
  'weekend': ['🎉', '🥳', '😎', '🍹', '🏖️'],
  'friday': ['🎉', '🥳', '🍹', '😎', '🔥'],
  
  // Weather
  'rain': ['🌧️', '☔', '💧', '🌈', '☁️'],
  'snow': ['❄️', '⛄', '☃️', '🌨️', '⛷️'],
  'sunny': ['☀️', '🌞', '😎', '🌻', '🌈'],
  
  // General positive vibes
  'good': ['👍', '😊', '✨', '⭐', '💯'],
  'best': ['🏆', '⭐', '💯', '🔥', '👑'],
  'new': ['✨', '🆕', '🎉', '⭐', '💫'],
  'life': ['❤️', '✨', '🌟', '💫', '🌈'],
  'day': ['☀️', '🌅', '✨', '😊', '💫'],
  'time': ['⏰', '⏱️', '✨', '⭐', '💫'],
  'moment': ['📸', '✨', '⭐', '💫', '❤️'],
  'memories': ['📸', '❤️', '✨', '🌟', '💕'],
  'dream': ['✨', '💫', '🌟', '☁️', '🌙'],
  'shine': ['✨', '⭐', '🌟', '💫', '☀️'],
  'bright': ['✨', '💡', '🌟', '☀️', '⭐'],
  'glow': ['✨', '🌟', '💫', '⭐', '🔥'],
  'vibes': ['✨', '🌊', '😎', '🔥', '💫'],
  'energy': ['⚡', '🔥', '💪', '✨', '🌟'],
  'magic': ['✨', '🪄', '🌟', '💫', '🎩'],
  'perfect': ['💯', '✨', '⭐', '👌', '🔥'],
};

/**
 * Select emojis based on keywords from caption and image description
 */
export const selectEmojisFromKeywords = (
  caption: string,
  imageDescription?: string
): string[] => {
  const text = `${caption} ${imageDescription || ''}`.toLowerCase();
  const selectedEmojis = new Set<string>();
  
  // Find matching emojis from keywords
  Object.entries(EMOJI_KEYWORDS).forEach(([keyword, emojis]) => {
    if (text.includes(keyword)) {
      // Add random emoji from matching keyword
      const randomEmoji = emojis[Math.floor(Math.random() * emojis.length)];
      selectedEmojis.add(randomEmoji);
    }
  });
  
  // If no matches, add some generic positive emojis
  if (selectedEmojis.size === 0) {
    selectedEmojis.add('✨');
    selectedEmojis.add('⭐');
  }
  
  // Convert to array and limit to 4
  const emojiArray = Array.from(selectedEmojis);
  
  // Randomly select 2-4 emojis
  const count = Math.min(Math.floor(Math.random() * 3) + 2, emojiArray.length); // 2-4
  const shuffled = emojiArray.sort(() => Math.random() - 0.5);
  
  return shuffled.slice(0, count);
};

/**
 * Generate random safe zone positions for emojis
 * Avoids center and distributes across corners and edges
 */
export interface EmojiPosition {
  left: number; // percentage
  top: number; // percentage
}

export const generateSafeZonePositions = (count: number): EmojiPosition[] => {
  // Define safe zones (avoiding center)
  const zones = [
    { left: 5, top: 5 },      // top-left
    { left: 85, top: 5 },     // top-right
    { left: 5, top: 85 },     // bottom-left
    { left: 85, top: 85 },    // bottom-right
    { left: 5, top: 45 },     // mid-left
    { left: 85, top: 45 },    // mid-right
    { left: 45, top: 5 },     // top-mid
    { left: 45, top: 85 },    // bottom-mid
  ];
  
  // Shuffle zones
  const shuffled = zones.sort(() => Math.random() - 0.5);
  
  // Return requested number of positions with slight randomness
  return shuffled.slice(0, count).map(zone => ({
    left: zone.left + (Math.random() * 10 - 5), // ±5% randomness
    top: zone.top + (Math.random() * 10 - 5),
  }));
};
